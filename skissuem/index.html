<!DOCTYPE html>
<html>
  <head>
    <title>Meme</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <script type="text/javascript" src="jquery-1.12.4.min.js"></script>
	<script type="text/javascript" src="attrchange.js"></script>
	<script type="text/javascript" src="attrchange_ext.js"></script>
    <script type="text/javascript">
    var tileDescMaxHeight = 37;
    if(isNaN(window.intervals)){
      window.intervals = 0;
    }
    function setTilesPositions(){
      var colsMax = 4;
      var tileColMargin = 10;
      var tileRowMargin = 10;
      var minTileW = 250;
      var windowW = $(".tile").parent().width();//$(window).width();
      if(colsMax*minTileW > windowW)
      {
        var colsMaxS = 0;
        for(var il = 0; il < colsMax; il++)
        {
          if(il*(minTileW+tileColMargin) <= windowW)
          {
            colsMaxS = il;
          }
        }
        colsMax = colsMaxS;
      }
      var cols = new Array(colsMax);
      for(var l = 0; l < colsMax; l++)
      {
        cols[l] = 0;
      }
      $(".tile").each(function() {
        var min = Array.min(cols);
        var minIndex = 0;
        for(var minI = 0; minI < colsMax; minI++)
        {
          if(cols[minI] == min)
          {
            minIndex = minI;
            break;
          }
        }
        var top = cols[minIndex] + 0;
        var tileWidth = (windowW*(1/colsMax)-tileColMargin);
        if(colsMax == 1){
        $(this).css({
            //"left":minIndex*windowW*((1/colsMax))+"px",
            "left":((minIndex*(tileWidth+(windowW-(tileWidth*colsMax)))))+"px",
            "top":top+"px",
            "width":tileWidth+"px"
        });
      }
        else {
          $(this).css({
              //"left":minIndex*windowW*((1/colsMax))+"px",
              "left":((minIndex*(tileWidth+(windowW-(tileWidth*colsMax))/(colsMax-1))))+"px",
              "top":top+"px",
              "width":tileWidth+"px"
          });
        }
        cols[minIndex] = cols[minIndex] + $(this).outerHeight() + tileRowMargin;
      });
      $(".tile").parent().css({
        "height":(Array.max(cols)-tileRowMargin)+"px"
      });
    }
    Array.min = function( array ){
    return Math.min.apply( Math, array );
    };

    Array.max = function( array ){
    return Math.max.apply( Math, array );
    };

    $(window).resize(setTilesPositions);
    $(window).load(setTilesPositions);
    $(document).ready(setTilesPositions);

	$(document).ready(function(){
		$(".test").hover(function(){
			$(".content").css({"width":"400px"});
			setTilesPositions();
		},function(){
			$(".content").css({"width":"960px"});
			setTilesPositions();
		});
	});
  if(isNaN(window.updater)){window.updater = 0;}
	$(document).ready(function(){
	$(".tile").hover(
	function()
	{
    window.updater = setInterval(checker, 100);
    window.intervals++;
		$(this).children(".desc").css({"max-height":"1000px"});
		setTilesPositions();
    },
	function()
	{
		$(this).children(".desc").css({"max-height":tileDescMaxHeight+"px"});
		setTilesPositions();
    }
	);
	});
	$(document).ready(function(){$(".tile").on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",
	function(){setTilesPositions();});});
  function checker(){
    $(".tile").each(function(){
      var changed = false;
      if($(this).children(".desc").css("max-height") != tileDescMaxHeight+"px")
      {
        changed = true;
        setTilesPositions();
      }
      if(!changed)
      {
        for(var i = 0; i < window.intervals; i++)
        {
          clearInterval(window.updater);
        }
      }
    });
  }


    </script>
  </head>
  <body>
    <div class="content">
    <div class="tile">
      <div class="title"><h1>Testowy długi tytuł meme nie joł aproxymowac</h1></div>
      <img src="https://i.ytimg.com/vi/178BWFbldCY/hqdefault.jpg"/>
      <div class="desc">Quokka bardzo wow ale meme Quokka bardzo wow ale meme Quokka bardzo wow ale meme Quokka bardzo wow ale meme Quokka bardzo wow ale meme</div>
    </div>
    <div class="tile">
      <div class="title"><h1>Testowy tytuł</h1></div>
      <img src="http://www.animalfactguide.com/wp-content/uploads/2013/08/quokka1.jpg"/>
      <div class="desc">Innen quokk bardzo meme</div>
    </div>
    <div class="tile">
      <div class="title"><h1>Testowy tytuł</h1></div>
      <img src="https://pbs.twimg.com/profile_images/378800000822867536/3f5a00acf72df93528b6bb7cd0a4fd0c.jpeg"/>
      <div class="desc">Doge such wow much meme</div>
    </div>
    <div class="tile">
      <div class="title"><h1>Testowy tytuł</h1></div>
      <img src="https://pbs.twimg.com/profile_images/378800000822867536/3f5a00acf72df93528b6bb7cd0a4fd0c.jpeg"/>
      <div class="desc">Doge such wow much meme</div>
    </div>
    <div class="tile">
      <div class="title"><h1>Testowy tytuł</h1></div>
      <img src="http://www.oddballs.co.uk/images/StageBalls.jpg"/>
      <div class="desc">Much balls veri meme</div>
    </div>
    <div class="tile">
      <div class="title"><h1>Testowy tytuł</h1></div>
      <img src="http://www.oddballs.co.uk/images/StageBalls.jpg"/>
      <div class="desc">Much balls veri meme</div>
    </div>
    <div class="tile">
      <div class="title"><h1>Testowy tytuł</h1></div>
      <img src="http://www.oddballs.co.uk/images/StageBalls.jpg"/>
      <div class="desc">Much balls veri meme</div>
    </div>
    <div class="tile">
      <div class="title"><h1>Testowy tytuł</h1></div>
      <img src="http://www.oddballs.co.uk/images/StageBalls.jpg"/>
      <div class="desc">Much balls veri meme</div>
    </div>
  </div>
  </body>
</html>
